"use strict";var app=angular.module("pptHeroApp",["ngCookies","ngResource","ngSanitize","ngRoute"]);app.config(["$routeProvider",function(a){a.when("/heroes",{templateUrl:"views/hero.html",controller:"HeroCtrl"}).when("/weapons",{templateUrl:"views/weapon.html",controller:"WeaponCtrl"}).when("/races",{templateUrl:"views/race.html",controller:"RaceCtrl"}).when("/jobs",{templateUrl:"views/jobs.html",controller:"JobCtrl"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),app.run(["$rootScope",function(a){a.APIUrl="http://localhost:2929/"}]),angular.module("pptHeroApp").controller("MainCtrl",["$scope","$http",function(a,b){a.roles=["heroes","weapons","races","jobs"],a.role="heroes",a.changeRole=function(b){a.role=b}}]),angular.module("pptHeroApp").controller("HeroCtrl",["$scope","heroFactory","jobFactory","raceFactory","weaponFactory",function(a,b,c,d,e){function f(a,b,c,d){return a.map(function(a){var e=b.filter(function(b){return b.id==a.weapon_id}),f=c.filter(function(b){return b.id==a.job_id}),g=d.filter(function(b){return b.id==a.race_id});return{id:a.id,name:a.name,weapon:e[0].name,job:f[0].name,race:g[0].name}})}function g(){b.getHeroes().success(function(b){a.heroes=b,Promise.all([c.getJobs(),d.getRaces(),e.getWeapons()]).then(function(c){var c=c.reduce(function(a,b,c,d){var e,f=b.config.url,g=f.lastIndexOf("/")+1;if(1==c){var h=a.config.url,i=f.lastIndexOf("/")+1;e={},e[h.substring(i)]=a.data}else e=a;return e[f.substring(g)]=b.data,e});a.$apply(function(){a.weapons=c.weapons,a.races=c.races,a.jobs=c.jobs,a.heroesData=f(b,c.weapons,c.jobs,c.races)})})["catch"](function(b){a.status="Unable to load additional data: "+b.message})}).error(function(b){a.status="Unable to load heroes: "+b.message})}a.status,a.heroes,a.pushable,a.editable,g(),a.hero,a.sex,a.race,a.tooglePushable=function(){a.pushable=!a.pushable,a.hero={}},a.edit=function(b){a.hero=b,a.race=a.races.filter(function(a){return a.id==b.race_id})[0].name,a.hero.editable=!0},a.changeSex=function(){a.hero.sex="Male"==a.hero.sex?"Female":"Male"},a.changeRace=function(b){var c=a.races.map(function(a){return a.name}),b="next"==b?1:-1,d=c.indexOf(a.race)+b;d>=0&&d<c.length&&(a.race=c[d],a.hero.race_id=a.races[d].id)},a.createHero=function(c){b.createHero(c).success(function(){g(),a.status="Created hero! Refreshing hero guild."}).error(function(b){a.status="Unable to create hero: "+b.message}),a.tooglePushable()},a.updateHero=function(c){a.heroes.indexOf(c);b.editHero(c).success(function(){a.status="Updated hero!. Refreshing Hero list.",g()}).error(function(b){a.status="Unable to update hero: "+b.message}),a.hero={}},a.deleteHero=function(c){b.deleteHero(c).success(function(){a.status="Deleted hero! Refreshing hero list.",g()}).error(function(b){a.status="Unable to delete hero: "+b.message})}}]),angular.module("pptHeroApp").controller("JobCtrl",["$scope","jobFactory","heroFactory",function(a,b,c){function d(){b.getJobs().success(function(b){a.jobs=b}).error(function(b){a.status="Unable to load jobs: "+b.message})}a.status,a.jobs,a.pushable,a.editable,d(),a.tooglePushable=function(){a.pushable=!a.pushable},a.toogleEditable=function(a){a.editable=!a.editable},a.createJob=function(c){b.createJob(c).success(function(){a.status="Inserted job! Refreshing job list.",a.jobs.push(c)}).error(function(b){a.status="Unable to create job: "+b.message}),a.tooglePushable(),a.job={}},a.updateJob=function(c){a.jobs.indexOf(c);b.editJob(c).success(function(){a.status="Updated job!. Refreshing Job list."}).error(function(b){a.status="Unable to update job: "+b.message}),a.toogleEditable(c)},a.deleteJob=function(d){var e;c.getHeroes().success(function(a){e=a.filter(function(a){return a.job_id==d})}).error(function(b){a.status="Unable to fetch heroes to compare: "+b.message}).then(function(){0==e.length?b.deleteJob(d).success(function(){a.status="Deleted job! Refreshing job list.",a.jobs.forEach(function(b,c){b.id==d&&a.jobs.splice(c,1)})}).error(function(b){a.status="Unable to delete job: "+b.message}):a.status="Cannot delete a job while it still has heroes"})}}]),angular.module("pptHeroApp").controller("WeaponCtrl",["$scope","weaponFactory",function(a,b){function c(){b.getWeapons().success(function(b){a.weapons=b}).error(function(b){a.status="Unable to load weapons: "+b.message})}a.status,a.weapons,a.pushable,a.editable,c(),a.tooglePushable=function(){a.pushable=!a.pushable},a.toogleEditable=function(a){a.editable=!a.editable},a.createWeapon=function(c){b.createWeapon(c).success(function(){a.status="Inserted weapon! Refreshing weapon list.",a.weapons.push(c)}).error(function(b){a.status="Unable to create weapon: "+b.message}),a.tooglePushable(),a.weapon={}},a.updateWeapon=function(c){a.weapons.indexOf(c);b.editWeapon(c).success(function(){a.status="Updated weapon!. Refreshing Weapon list."}).error(function(b){a.status="Unable to update weapon: "+b.message}),a.toogleEditable(c)},a.deleteWeapon=function(c){var d;heroFactory.getHeroes().success(function(a){d=a.filter(function(a){return a.weapon_id==c})}).error(function(b){a.status="Unable to fetch heroes to compare: "+b.message}).then(function(){0==d.length?b.deleteWeapon(c).success(function(){a.status="Deleted weapon! Refreshing weapon list.",a.weapons.forEach(function(b,d){b.id==c&&a.weapons.splice(d,1)})}).error(function(b){a.status="Unable to delete weapon: "+b.message}):a.status="Cannot delete a weapon while it still has heroes"})}}]),angular.module("pptHeroApp").controller("RaceCtrl",["$scope","raceFactory",function(a,b){function c(){b.getRaces().success(function(b){a.races=b}).error(function(b){a.status="Unable to load races:"+b.message})}a.status,a.races,a.pushable,a.editable,c(),a.tooglePushable=function(){a.pushable=!a.pushable},a.toogleEditable=function(a){a.editable=!a.editable},a.createRace=function(c){b.createRace(c).success(function(){a.status="Inserted race! Refreshing race list.",a.races.push(c)}).error(function(b){a.status="Unable to create race"+b.message}),a.tooglePushable(),a.race={}},a.updateRace=function(c){a.races.indexOf(c);b.editRace(c).success(function(){a.status="Updated race!. Refreshing Race list."}).error(function(b){a.status="Unable to update race:"+b.message}),a.toogleEditable(c)},a.deleteRace=function(c){var d;heroFactory.getHeroes().success(function(a){d=a.filter(function(a){return a.race_id==c})}).error(function(b){a.status="Unable to fetch heroes to compare: "+b.message}).then(function(){0==d.length?b.deleteRace(c).success(function(){a.status="Deleted race! Refreshing race list.",a.races.forEach(function(b,d){b.id==c&&a.races.splice(d,1)})}).error(function(b){a.status="Unable to delete race: "+b.message}):a.status="Cannot delete a race while it still has heroes"})}}]),angular.module("pptHeroApp").factory("jobFactory",["$http",function(a){var b="http://localhost:2929/api/v1/jobs",c={};return c.getJobs=function(){return a.get(b)},c.getJob=function(c){return a.get(b+"/"+c)},c.createJob=function(c){return a.post(b,c)},c.editJob=function(c){return a.put(b+"/"+c.id,c)},c.deleteJob=function(c){return a["delete"](b+"/"+c)},c}]),angular.module("pptHeroApp").factory("weaponFactory",["$http",function(a){var b="http://localhost:2929/api/v1/weapons",c={};return c.getWeapons=function(){return a.get(b)},c.getWeapon=function(c){return a.get(b+"/"+c)},c.createWeapon=function(c){return a.post(b,c)},c.editWeapon=function(c){return a.put(b+"/"+c.id,c)},c.deleteWeapon=function(c){return a["delete"](b+"/"+c)},c}]),angular.module("pptHeroApp").factory("raceFactory",["$http",function(a){var b="http://localhost:2929/api/v1/races",c={};return c.getRaces=function(){return a.get(b)},c.getRace=function(c){return a.get(b+"/"+c)},c.createRace=function(c){return a.post(b,c)},c.editRace=function(c){return a.put(b+"/"+c.id,c)},c.deleteRace=function(c){return a["delete"](b+"/"+c)},c}]),angular.module("pptHeroApp").factory("heroFactory",["$http",function(a){var b="http://localhost:2929/api/v1/heroes",c={};return c.getHeroes=function(){return a.get(b)},c.getHero=function(c){return a.get(b+"/"+c)},c.createHero=function(c){return a.post(b,c)},c.editHero=function(c){return a.put(b+"/"+c.id,c)},c.deleteHero=function(c){return a["delete"](b+"/"+c)},c}]);